<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-YR1B2Z51N0"></script>
  <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());

     gtag('config', 'G-YR1B2Z51N0');
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="icon" href="images/mylogo_nevengi_circle.webp" type="image/jpg">
  <title>Complete Your Profile</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }
    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 40px 20px;
    }
    .card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 40px;
      width: 100%;
      max-width: 700px;
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
      color: white;
    }
    .card h2 {
      margin-bottom: 20px;
      font-weight: 600;
      font-size: 28px;
      text-align: center;
    }
    .step {
      display: none;
    }
    .step.active {
      display: block;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-size: 16px;
      color: #e0e0e0;
    }
    input[type=range] {
      width: 100%;
    }
    .slider-value {
      margin-top: 5px;
      font-size: 14px;
      text-align: right;
      color: #ccc;
    }
    .channels-group {
      margin-bottom: 20px;
    }
    .channels-group h3 {
      margin-bottom: 10px;
      font-size: 20px;
    }
    .channels-group label {
      display: inline-block;
      margin-right: 15px;
      font-size: 14px;
      cursor: pointer;
    }
    .channels-group input[type="checkbox"] {
      margin-right: 5px;
    }
    button {
      margin-top: 20px;
      width: 48%;
      padding: 12px;
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      color: white;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
    }
    button:hover {
      background-color: rgba(255, 255, 255, 0.3);
    }
    .btn-group {
      display: flex;
      justify-content: space-between;
    }
  </style>
</head>
<body>
  <!-- Add this just after <body> -->
  <div id="discord-signup-card" style="display:none; max-width: 420px; margin: 60px auto 0; background: rgba(30, 32, 40, 0.95); border-radius: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.25); color: #fff; text-align: center; padding: 2.5rem 2rem;">
    <img src="images/discord-icon.png" alt="Discord" style="width: 64px; height: 64px; margin-bottom: 1.5rem;">
    <h2 style="margin-bottom: 1rem; font-size: 1.5rem;">Sign up with Discord</h2>
    <p style="margin-bottom: 2rem; font-size: 1.1rem;">To complete your profile and get your personalized channels, please sign up with Discord first.</p>
    <a href="/auth/discord/user" style="display: inline-block; background: #5865F2; color: #fff; font-weight: bold; border-radius: 24px; padding: 1rem 2.5rem; font-size: 1.1rem; text-decoration: none; box-shadow: 0 2px 8px rgba(0,0,0,0.15); transition: background 0.2s;">Sign up with Discord</a>
  </div>

  <!-- Add this after the discord-signup-card -->
  <div id="already-completed-card" style="display:none; max-width: 420px; margin: 60px auto 0; background: rgba(30, 32, 40, 0.95); border-radius: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.25); color: #fff; text-align: center; padding: 2.5rem 2rem;">
    <img src="images/mylogo_nevengi_circle.webp" alt="Profile Complete" style="width: 64px; height: 64px; margin-bottom: 1.5rem;">
    <h2 style="margin-bottom: 1rem; font-size: 1.5rem;">Profile Already Completed</h2>
    <p style="margin-bottom: 2rem; font-size: 1.1rem;">You have already completed your profile! Redirecting you to your dashboard...</p>
  </div>

  <div class="card" id="profile-form-card">
    <h2>Complete Your Profile</h2>
    <form id="multiStepForm">

      <input type="hidden" id="discord_id" name="discord_id" value="" />

      <!-- Step 1: Life Sector Ratings -->
      <div class="step active" id="step1">
        <h3>Rate Your Life Sectors</h3>
        <div class="form-group">
          <label for="physical">Physical Health</label>
          <input type="range" name="physical" id="physical" min="1" max="10" value="5" oninput="updateValue(this)">
          <div class="slider-value" id="value_physical">5</div>
        </div>
        <div class="form-group">
          <label for="mental">Mental & Emotional Wellbeing</label>
          <input type="range" name="mental" id="mental" min="1" max="10" value="5" oninput="updateValue(this)">
          <div class="slider-value" id="value_mental">5</div>
        </div>
        <div class="form-group">
          <label for="social">Social Confidence</label>
          <input type="range" name="social" id="social" min="1" max="10" value="5" oninput="updateValue(this)">
          <div class="slider-value" id="value_social">5</div>
        </div>
        <div class="form-group">
          <label for="love">Love & Relationships</label>
          <input type="range" name="love" id="love" min="1" max="10" value="5" oninput="updateValue(this)">
          <div class="slider-value" id="value_love">5</div>
        </div>
        <div class="form-group">
          <label for="career">Career or Business</label>
          <input type="range" name="career" id="career" min="1" max="10" value="5" oninput="updateValue(this)">
          <div class="slider-value" id="value_career">5</div>
        </div>
        <div class="form-group">
          <label for="creative">Creative Expression</label>
          <input type="range" name="creative" id="creative" min="1" max="10" value="5" oninput="updateValue(this)">
          <div class="slider-value" id="value_creative">5</div>
        </div>
        <div class="form-group">
          <label for="travel">Travel / Adventure</label>
          <input type="range" name="travel" id="travel" min="1" max="10" value="5" oninput="updateValue(this)">
          <div class="slider-value" id="value_travel">5</div>
        </div>
        <div class="form-group">
          <label for="family">Family & Close Connections</label>
          <input type="range" name="family" id="family" min="1" max="10" value="5" oninput="updateValue(this)">
          <div class="slider-value" id="value_family">5</div>
        </div>
        <div class="form-group">
          <label for="style">Personal Style & Appearance</label>
          <input type="range" name="style" id="style" min="1" max="10" value="5" oninput="updateValue(this)">
          <div class="slider-value" id="value_style">5</div>
        </div>
        <div class="form-group">
          <label for="spiritual">Spirituality & Mindset</label>
          <input type="range" name="spiritual" id="spiritual" min="1" max="10" value="5" oninput="updateValue(this)">
          <div class="slider-value" id="value_spiritual">5</div>
        </div>
        <div class="btn-group">
          <button type="button" onclick="nextStep()">Next</button>
        </div>
      </div>

      <!-- Step 2: Identity Information -->

      <div class="step" id="step2">
        <h3>Identity Details</h3>
        <!-- Date of Birth -->
  
        <div class="form-group">
    
          <label for="date_of_birth">Date of Birth:</label>
    
          <input type="date" id="date_of_birth" name="date_of_birth" required />
    
          <small id="dob-warning" style="color: red; display: none;"></small>
  
        </div>

  
        <!-- Country (Required) -->
  
        <div class="form-group">
    
          <label for="country">Country (Required):</label>
    
          <input type="text" id="country" name="country" required placeholder="Enter your country" />
  
        </div>

  
        
  
        <!-- Gender -->
  
        <div class="form-group">
    
          <label for="gender">Gender:</label>
    
          <select id="gender" name="gender" required>
      
            <option value="">Select</option>
      
            <option value="male">Male</option>
      
            <option value="female">Female</option>
    
          </select>
  
        </div>

  
        <!-- Buttons -->
  
        <div class="btn-group">
    
          <button type="button" onclick="prevStep()">Back</button>
    
          <button type="button" onclick="validateStep2()">Next</button>
  
        </div>

      </div>



      <!-- Step 3: Channel Selection -->
      <div class="step" id="step3">
        <h3>Select the Channels You Like</h3>

        <!-- Category 1: Physical Health -->
        <div class="channels-group">
          <h3>Physical Health üèãÔ∏è‚Äç‚ôÇÔ∏è</h3>
          <label><input type="checkbox" name="channel_physical_men"> Physical Fitness for Men</label>
          <label><input type="checkbox" name="channel_physical_women"> Physical Fitness for Women</label>
          <label><input type="checkbox" name="channel_physical_health"> Physical Health</label>
        </div>

        <!-- Category 2: Mental & Emotional Wellbeing -->
        <div class="channels-group">
          <h3>Mental & Emotional Wellbeing üßò‚Äç‚ôÇÔ∏è</h3>
          <label><input type="checkbox" name="channel_yoga"> Yoga</label>
          <label><input type="checkbox" name="channel_meditation"> Meditation</label>
        </div>

        <!-- Category 3: Social Confidence -->
        <div class="channels-group">
          <h3>Social Confidence üó£Ô∏è</h3>
          <label><input type="checkbox" name="channel_public_speaking"> Public Speaking</label>
          <label><input type="checkbox" name="channel_social_confidence"> Social Confidence</label>
          <label><input type="checkbox" name="channel_influencing"> Influencing</label>
        </div>

        <!-- Category 4: Love & Relationships -->
        <div class="channels-group">
          <h3>Love & Relationships ‚ù§Ô∏è</h3>
          <label><input type="checkbox" name="channel_dating_men"> Dating for Men</label>
          <label><input type="checkbox" name="channel_dating_women"> Dating for Women</label>
        </div>

        <!-- Category 5: Career or Business -->
        <div class="channels-group">
          <h3>Career or Business üíº</h3>
          <label><input type="checkbox" name="channel_entrepreneurship"> Entrepreneurship</label>
          <label><input type="checkbox" name="channel_work_career"> Work and Career</label>
          <label><input type="checkbox" name="channel_ai"> Artificial Intelligence</label>
        </div>

        <!-- Category 6: Creative Expression -->
        <div class="channels-group">
          <h3>Creative Expression üé®</h3>
          <label><input type="checkbox" name="channel_art"> Art</label>
          <label><input type="checkbox" name="channel_music"> Music</label>
          <label><input type="checkbox" name="channel_diy"> DIY & Crafting</label>
        </div>

        <!-- Category 7: Travel / Adventure -->
        <div class="channels-group">
          <h3>Travel / Adventure ‚úàÔ∏è</h3>
          <label><input type="checkbox" name="channel_travelling"> Travelling</label>
          <label><input type="checkbox" name="channel_adrenaline"> Adrenaline Adventure</label>
        </div>

        <!-- Category 8: Family & Close Connections -->
        <div class="channels-group">
          <h3>Family & Close Connections üë®‚Äçüë©‚Äçüëß‚Äçüë¶</h3>
          <label><input type="checkbox" name="channel_family"> Family and Close Friends</label>
        </div>

        <!-- Category 9: Personal Style & Appearance -->
        <div class="channels-group">
          <h3>Personal Style & Appearance üëó</h3>
          <label><input type="checkbox" name="channel_fashion"> Appearance and Fashion</label>
          <label><input type="checkbox" name="channel_minimalism"> Minimalism</label>
        </div>

        <!-- Category 10: Spirituality & Mindset -->
        <div class="channels-group">
          <h3>Spirituality & Mindset üôè</h3>
          <label><input type="checkbox" name="channel_loa"> Law of Attraction</label>
          <label><input type="checkbox" name="channel_manifestation"> Manifestation and Visualization</label>
          <label><input type="checkbox" name="channel_spirituality"> Spirituality</label>
          <label><input type="checkbox" name="channel_stoicism"> Stoicism and Philosophy</label>
          <label><input type="checkbox" name="channel_gratitude"> Gratitude</label>
          <label><input type="checkbox" name="channel_masculine_energy"> Masculine Energy</label>
          <label><input type="checkbox" name="channel_feminine_energy"> Feminine Energy</label>
          <label><input type="checkbox" name="channel_tarot"> Tarot</label>
        </div>

        <!-- Terms & Conditions Checkbox -->
        <div class="form-group">
          <label style="display: flex; align-items: center; gap: 10px;">
            <input type="checkbox" name="myCheckbox" id="myCheckbox" required>
            <span>
              I have read and understood the 
              <a href="/terms.html" target="_blank" style="color: #4fc3f7; text-decoration: underline;">
                Terms & Conditions
              </a> 
              of Nevengi and agree to proceed.
            </span>
          </label>
          <p style="color: #ccc; font-size: 12px; margin-top: 5px;">*required</p>
        </div>
           

        <div class="btn-group">
          <button type="button" onclick="prevStep()">Back</button>
          <button type="submit">Submit</button>
        </div>
      </div>
    </form>
  </div>

  <script>
    // Manage step navigation
    let currentStep = 1;
    const totalSteps = 3;

    function showStep(step) {
      for (let i = 1; i <= totalSteps; i++) {
        document.getElementById('step' + i).classList.remove('active');
      }
      document.getElementById('step' + step).classList.add('active');
      currentStep = step;
    }

    function nextStep() {
      if (currentStep < totalSteps) {
        showStep(currentStep + 1);
      }
    }

    function prevStep() {
      if (currentStep > 1) {
        showStep(currentStep - 1);
      }
    }

    // Auto-fill Discord ID from URL parameter
    const params = new URLSearchParams(window.location.search);
    const discordId = params.get('discord_id');

    if (discordId) {
      // Check if already completed
      fetch(`/api/check-identity-completed?discord_id=${encodeURIComponent(discordId)}`)
        .then(res => res.json())
        .then(data => {
          if (data.completed) {
            document.getElementById('profile-form-card').style.display = 'none';
            document.getElementById('discord-signup-card').style.display = 'none';
            document.getElementById('already-completed-card').style.display = '';
            setTimeout(() => {
              window.location.href = '/user_dashboard.html';
            }, 2000);
          } else {
            document.getElementById('discord_id').value = discordId;
            document.getElementById('profile-form-card').style.display = '';
            document.getElementById('discord-signup-card').style.display = 'none';
            document.getElementById('already-completed-card').style.display = 'none';
          }
        });
    } else {
      document.getElementById('profile-form-card').style.display = 'none';
      document.getElementById('discord-signup-card').style.display = '';
      document.getElementById('already-completed-card').style.display = 'none';
    }

    // Update slider value display for range inputs
    function updateValue(slider) {
      const display = document.getElementById(`value_${slider.id}`);
      if (display) {
        display.textContent = slider.value;
      }
    }


  
  // Add this to the end of your existing <script> section
  function calculateAge(dob) {
    const birthDate = new Date(dob);
    const today = new Date();
    let age = today.getFullYear() - birthDate.getFullYear();
    const m = today.getMonth() - birthDate.getMonth();
    if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
      age--;
    }
    return age;
  }

  function validateStep2() {
    const dob = document.getElementById("date_of_birth").value;
    const country = document.getElementById("country").value.trim();
    const gender = document.getElementById("gender").value;
    const warning = document.getElementById("dob-warning");

    warning.style.display = "none";
    warning.textContent = "";

    if (!dob) {
      warning.textContent = "Please enter your date of birth.";
      warning.style.display = "block";
      return;
    }

    const age = calculateAge(dob);

    if (age < 13) {
      warning.textContent = "Sorry, you must be at least 13 years old to join Nevengi.";
      warning.style.display = "block";
      return;
    }

    if (age > 100) {
      warning.textContent = "Please enter a valid age below 100.";
      warning.style.display = "block";
      return;
    }

    if (!country) {
      alert("Please enter your country.");
      return;
    }

    if (!gender) {
      alert("Please select your gender.");
      return;
    }

    nextStep(); // Everything is valid ‚Äî go to the next step
  }
  </script>


  <script>
   document.getElementById("multiStepForm").addEventListener("submit", async function (e) {
    e.preventDefault(); // Stop the default ugly page reload

    const formData = new FormData(this);
    const payload = Object.fromEntries(formData.entries());

    try {
      const res = await fetch("/api/submit", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      const data = await res.json();
      if (res.ok) {
        alert("‚úÖ Profile submitted successfully! Redirecting to your dashboard...");
        window.location.href = "/user_dashboard.html";
      } else {
        alert("‚ùå Submission error: " + (data.error || "Unknown issue"));
      }
    } catch (err) {
      console.error("üö® Submission failed:", err);
      alert("Something went wrong. Please try again.");
    }
   });
  </script>

</body>
</html>
