<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-YR1B2Z51N0"></script>
  <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());
     gtag('config', 'G-YR1B2Z51N0');
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Nevengi - Connect with Expert Coaches</title>
  <meta name="description" content="Join Nevengi to connect with expert coaches or share your expertise as an influencer." />
  <meta name="author" content="Nevengi" />
  <meta property="og:title" content="Nevengi - Connect with Expert Coaches" />
  <meta property="og:description" content="Join Nevengi to connect with expert coaches or share your expertise as an influencer." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@lovable_dev" />
  <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* --- Tailwind-inspired CSS (flattened for standalone use) --- */
    :root {
      --background: #f6faff;
      --foreground: #232a36;
      --brand-purple: #3A86FF;
      --brand-teal: #4CC9F0;
      --brand-light: #F0F7FF;
      --brand-dark: #1A1F2C;
      --muted-foreground: #6b7280;
      --radius: 0.75rem;
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      background: var(--background);
      color: var(--foreground);
      min-height: 100vh;
    }
    h1, h2, h3, h4, h5, h6 {
      font-weight: bold;
      letter-spacing: -0.01em;
    }
    .illustrated-bg {
      background-image: url('images/backgroundsignup.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      min-height: 100vh;
      position: relative;
    }
    @media (max-width: 600px) {
      .illustrated-bg {
        background-image: url('images/backgroundmobilesignup.png');
      }
    }
    .illustrated-bg::before {
      content: none !important;
    }
    .main-card {
      position: relative;
      padding: 2rem;
      border-radius: 2rem;
      border: 1px solid rgba(255,255,255,0.5);
      background: rgba(255,255,255,0.7);
      backdrop-filter: blur(8px);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
      transition: box-shadow 0.3s, transform 0.3s;
      margin-bottom: 2rem;
    }
    .button-primary {
      padding: 0.75rem 1.5rem;
      border-radius: 9999px;
      background: linear-gradient(to right, var(--brand-purple), var(--brand-teal));
      color: #fff;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: box-shadow 0.3s, transform 0.2s;
      margin: 0.25rem;
    }
    .button-primary:hover {
      box-shadow: 0 4px 16px 0 rgba(58,134,255,0.15);
      transform: scale(1.05);
    }
    .button-secondary {
      padding: 0.75rem 1.5rem;
      border-radius: 9999px;
      background: rgba(255,255,255,0.8);
      color: var(--brand-purple);
      border: 1px solid #3A86FF33;
      font-weight: 600;
      cursor: pointer;
      margin: 0.25rem;
      transition: box-shadow 0.3s, background 0.3s, transform 0.2s;
    }
    .button-secondary:hover {
      background: var(--brand-light);
      box-shadow: 0 2px 8px 0 rgba(58,134,255,0.08);
      transform: scale(1.05);
    }
    .menu-item {
      padding: 0.5rem 1.25rem;
      border-radius: 0.5rem;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: inherit;
      text-decoration: none;
    }
    .menu-item:hover {
      background: #f3f4f6;
    }
    .text-center { text-align: center; }
    .text-muted-foreground { color: var(--muted-foreground); }
    .font-bold { font-weight: bold; }
    .mb-4 { margin-bottom: 1rem; }
    .mb-6 { margin-bottom: 1.5rem; }
    .mb-8 { margin-bottom: 2rem; }
    .mb-12 { margin-bottom: 3rem; }
    .mt-10 { margin-top: 2.5rem; }
    .w-full { width: 100%; }
    .max-w-4xl { max-width: 64rem; }
    .max-w-2xl { max-width: 42rem; }
    .mx-auto { margin-left: auto; margin-right: auto; }
    .px-4 { padding-left: 1rem; padding-right: 1rem; }
    .pt-24 { padding-top: 6rem; }
    .pb-16 { padding-bottom: 4rem; }
    .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
    .gap-4 { gap: 1rem; }
    .gap-6 { gap: 1.5rem; }
    .gap-8 { gap: 2rem; }
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .flex-row { flex-direction: row; }
    .items-center { align-items: center; }
    .justify-center { justify-content: center; }
    .rounded-full { border-radius: 9999px; }
    .rounded-2xl { border-radius: 2rem; }
    .shadow-lg { box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1); }
    .shadow-xl { box-shadow: 0 12px 48px 0 rgba(31, 38, 135, 0.12); }
    .min-h-screen { min-height: 100vh; }
    .relative { position: relative; }
    .absolute { position: absolute; }
    .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
    .z-neg1 { z-index: -1; }
    .z-40 { z-index: 40; }
    .z-50 { z-index: 50; }
    .fixed { position: fixed; }
    .top-0 { top: 0; }
    .left-0 { left: 0; }
    .right-0 { right: 0; }
    .w-32 { width: 8rem; }
    .h-32 { height: 8rem; }
    .mx-auto { margin-left: auto; margin-right: auto; }
    .animation-fade-in { animation: fade-in 0.5s ease-out; }
    .animate-float { animation: float 3s ease-in-out infinite; }
    .animate-slide-in { animation: slide-in 0.5s ease-out; }
    .animate-pulse-soft { animation: pulse-soft 3s ease-in-out infinite; }
    @keyframes fade-in {
      0% { opacity: 0; transform: translateY(10px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    @keyframes slide-in {
      0% { transform: translateX(100%); opacity: 0; }
      100% { transform: translateX(0); opacity: 1; }
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    @keyframes pulse-soft {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }
    /* Hamburger styles */
    .hamburger { background: none; border: none; cursor: pointer; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 2.5rem; width: 2.5rem; }
    .hamburger div { height: 0.25rem; width: 1.5rem; background: var(--foreground); border-radius: 9999px; margin-bottom: 0.25rem; transition: all 0.3s; }
    .hamburger.active div:nth-child(1) { transform: translateY(0.375rem) rotate(45deg); }
    .hamburger.active div:nth-child(2) { opacity: 0; }
    .hamburger.active div:nth-child(3) { transform: translateY(-0.375rem) rotate(-45deg); }
    .menu-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 30; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
    .menu-overlay.active { opacity: 1; pointer-events: auto; }
    /* Responsive */
    @media (max-width: 768px) {
      .main-card { padding: 0.75rem; margin-bottom: 1rem; }
      .pt-24 { padding-top: 2.5rem; }
      .pb-16 { padding-bottom: 2rem; }
      .max-w-4xl, .max-w-2xl { max-width: 100vw; }
      .w-32, .h-32 { width: 5.5rem; height: 5.5rem; }
      .gap-8 { gap: 1rem; }
      .animation-fade-in, .animate-slide-in { animation-duration: 0.3s; }
    }
    @media (max-width: 600px) {
      html, body {
        overflow-x: hidden !important;
        box-sizing: border-box !important;
        width: 100vw !important;
        max-width: 100vw !important;
      }
      .px-4 {
        padding-left: 0 !important;
        padding-right: 0 !important;
      }
      .w-full, .max-w-4xl, .mx-auto {
        max-width: 100vw !important;
        width: 100vw !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
      }
      .main-card {
        width: 95vw !important;
        max-width: 95vw !important;
        min-width: 0 !important;
        margin: 0 auto !important;
        padding: 1rem 0.5rem 1.2rem 0.5rem !important;
        border-radius: 1.1rem !important;
        box-sizing: border-box !important;
      }
      .main-card img, .main-card .w-32, .main-card .h-32 {
        width: 56px !important;
        height: 56px !important;
        margin: 0 auto 0.7rem auto !important;
        display: block !important;
      }
      .main-card button, .main-card .button-primary, .main-card .button-secondary {
        width: 100% !important;
        min-width: 0 !important;
        margin: 0.4rem 0 0.4rem 0 !important;
        font-size: 1.05rem !important;
        box-sizing: border-box !important;
      }
      .main-card h2, .main-card h1 {
        font-size: 1.08rem !important;
        text-align: center !important;
        margin-bottom: 0.5rem !important;
      }
      .main-card p, .main-card .text-center, .main-card .text-muted-foreground, .main-card .font-medium {
        font-size: 0.98rem !important;
        text-align: center !important;
        margin-bottom: 0.4rem !important;
      }
      main.pt-24.pb-16.min-h-screen.flex.items-center {
        min-height: 100vh !important;
        padding-top: 0 !important;
        padding-bottom: 0 !important;
        justify-content: center !important;
      }
    }
  </style>
  <meta name="theme-color" content="#000000" />
  <link rel="manifest" href="/manifest.json" />
  <link rel="apple-touch-icon" href="images/nevengilogo.webp" />
  <script>
    // --- LOGIN REDIRECTION LOGIC (CLEAN SLATE) ---
    (function() {
      async function validateToken(token, type) {
        if (!token) return false;
        try {
          const res = await fetch(`/auth/validate-${type}`, {
            method: 'GET',
            headers: { 'Authorization': `Bearer ${token}` }
          });
          if (!res.ok) return false;
          const data = await res.json();
          return data.valid === true;
        } catch (e) {
          console.log('[DEBUG] Token validation error:', e);
          return false;
        }
      }
      window.addEventListener('DOMContentLoaded', async () => {
        const userToken = localStorage.getItem('userToken');
        const coachToken = localStorage.getItem('coachToken');
        console.log('[DEBUG] Checking login tokens...');
        if (coachToken) {
          const validCoach = await validateToken(coachToken, 'coach');
          console.log('[DEBUG] coachToken found. Valid:', validCoach);
          if (validCoach) {
            console.log('[DEBUG] Redirecting to /coach_dashboard.html');
            window.location.replace('/coach_dashboard.html');
            return;
          } else {
            localStorage.removeItem('coachToken');
          }
        }
        if (userToken) {
          const validUser = await validateToken(userToken, 'user');
          console.log('[DEBUG] userToken found. Valid:', validUser);
          if (validUser) {
            console.log('[DEBUG] Redirecting to /user_dashboard.html');
            window.location.replace('/user_dashboard.html');
            return;
          } else {
            localStorage.removeItem('userToken');
          }
        }
        console.log('[DEBUG] No valid login found. Staying on index.html.');
      });
    })();
  </script>
</head>
<body>
  <div class="illustrated-bg">
    <nav class="fixed top-0 left-0 right-0 z-40 flex items-center justify-between px-4 py-4 bg-white" style="background:rgba(255,255,255,0.6);backdrop-filter:blur(8px);">
      <div class="flex items-center">
        <h1 class="text-xl font-bold" style="color:#18181b; background:none; background-clip:unset; -webkit-background-clip:unset; -webkit-text-fill-color:unset;">Nevengi</h1>
      </div>
      <button class="hamburger z-50 p-2" id="menuBtn" aria-label="Menu">
        <div></div><div></div><div></div>
      </button>
    </nav>
    <div class="menu-overlay" id="menuOverlay"></div>
    <div id="sideMenu" style="position:fixed;top:0;right:0;z-index:40;height:100%;width:16rem;background:#fff;box-shadow:0 0 24px 0 rgba(0,0,0,0.08);transform:translateX(100%);transition:transform 0.3s; padding-top:5rem;padding-left:1rem;padding-right:1rem;">
      <div class="flex flex-col gap-6">
        <a href="/auth/discord/user" class="button-primary" style="text-align:center; text-decoration:none;">User Login</a>
        <a href="/auth/discord" class="button-secondary" style="text-align:center; text-decoration:none;">Coach Login</a>
        <a href="https://nevengi-research-center.super.site/" class="button-secondary" target="_blank" rel="noopener noreferrer" style="text-align:center; text-decoration:none;">NRC</a>
        <a href="https://discord.gg/SYtbqPMqju" class="button-secondary" target="_blank" rel="noopener noreferrer" style="display:flex;align-items:center;justify-content:center;gap:8px;text-align:center; text-decoration:none;">
          <img src="images/discord-icon.png" alt="Discord Icon" style="width:20px;height:20px;margin-right:8px;">Join Discord
        </a>
      </div>
      <div class="mt-10 flex flex-col gap-2">
        <a href="#" class="menu-item">About Us</a>
        <a href="#" class="menu-item">Success Stories</a>
        <a href="#" class="menu-item">FAQ</a>
        <a href="#" class="menu-item">Contact</a>
      </div>
    </div>
    <main class="pt-24 pb-16 min-h-screen flex items-center" style="flex-direction:column;justify-content:center;">
      <div id="stepContainer" class="w-full"></div>
    </main>
    <footer class="py-6 text-center text-sm text-muted-foreground">
      <p>Â© 2025 Nevengi. All rights reserved.</p>
    </footer>
  </div>
  <div class="absolute inset-0 z-neg1"></div>
  <script>
    // Hamburger menu logic
    const menuBtn = document.getElementById('menuBtn');
    const menuOverlay = document.getElementById('menuOverlay');
    const sideMenu = document.getElementById('sideMenu');
    let menuOpen = false;
    menuBtn.addEventListener('click', () => {
      menuOpen = !menuOpen;
      menuBtn.classList.toggle('active', menuOpen);
      menuOverlay.classList.toggle('active', menuOpen);
      sideMenu.style.transform = menuOpen ? 'translateX(0)' : 'translateX(100%)';
    });
    menuOverlay.addEventListener('click', () => {
      menuOpen = false;
      menuBtn.classList.remove('active');
      menuOverlay.classList.remove('active');
      sideMenu.style.transform = 'translateX(100%)';
    });
    // Step logic
    const stepContainer = document.getElementById('stepContainer');
    let currentStep = 'select-type';
    let userType = null;
    let hasEnoughFollowers = null;
    function renderStep() {
      if (currentStep === 'select-type') {
        stepContainer.innerHTML = `
          <div class="w-full max-w-4xl mx-auto px-4 animation-fade-in">
            <h2 class="text-2xl font-bold text-center mb-12">
              Find Your <span style="background:linear-gradient(to right, var(--brand-purple), var(--brand-teal));-webkit-background-clip:text;-webkit-text-fill-color:transparent;">Perfect Path</span>
            </h2>
            <div class="flex gap-8" style="display:grid;grid-template-columns:1fr 1fr;gap:2rem;">
              <div class="main-card cursor-pointer" id="userCard">
                <div class="flex flex-col items-center">
                  <div class="w-32 h-32 mb-6 animate-float">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxjaXJjbGUgY3g9IjEyIiBjeT0iOSIgcj0iMyIgc3Ryb2tlPSIjM0E4NkZGIiBzdHJva2Utd2lkdGg9IjEuNSIvPjxwYXRoIGQ9Ik0xNy43OTcgMTcuNzk3QzE2LjUzMiAxNi41MzIgMTQuMzIyIDE2IDEyIDE2QzkuNjc4IDE2IDcuNDY3IDE2LjUzMiA2LjIwMyAxNy43OTciIHN0cm9rZT0iIzNBODZGRiIgc3Ryb2tlLXdpZHRoPSIxLjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjEwIiBzdHJva2U9IiMzQTg2RkYiIHN0cm9rZS13aWR0aD0iMS41Ii8+PC9zdmc+" alt="User Icon" class="w-full h-full" />
                  </div>
                  <h3 class="text-xl font-bold text-center mb-4">I'm Looking for Guidance</h3>
                  <p class="text-center text-muted-foreground mb-6">Get personalized coaching, discover new routines, and track your progress on your self-improvement journey.</p>
                  <button class="button-primary w-full" id="userSelectBtn">Select</button>
                </div>
              </div>
              <div class="main-card cursor-pointer" id="influencerCard">
                <div class="flex flex-col items-center">
                  <div class="w-32 h-32 mb-6 animate-float">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik04IDEzVjE3TTEyIDEwVjE3TTE2IDdWMTciIHN0cm9rZT0iIzRDQzlGMCIgc3Ryb2tlLXdpZHRoPSIxLjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjxjaXJjbGUgY3g9IjgiIGN5PSI3IiByPSIyIiBzdHJva2U9IiM0Q0M5RjAiIHN0cm9rZS13aWR0aD0iMS41Ii8+PGNpcmNsZSBjeD0iMTYiIGN5PSIzIiByPSIyIiBzdHJva2U9IiM0Q0M5RjAiIHN0cm9rZS13aWR0aD0iMS41Ii8+PGNpcmNsZSBjeD0iMTIiIGN5PSI2IiByPSIyIiBzdHJva2U9IiM0Q0M5RjAiIHN0cm9rZS13aWR0aD0iMS41Ii8+PHBhdGggZD0iTTIwIDE5QzIwIDIwLjEwNDYgMTkuMTA0NiAyMSAxMyAyMUM2Ljg5NTQzIDIxIDYgMjAuMTA0NiA2IDE5QzYgMTcuODk1NCA2Ljg5NTQzIDE3IDEzIDE3QzE5LjEwNDYgMTcgMjAgMTcuODk1NCAyMCAxOVoiIHN0cm9rZT0iIzRDQzlGMCIgc3Ryb2tlLXdpZHRoPSIxLjUiLz48L3N2Zz4K" alt="Coach Icon" class="w-full h-full" />
                  </div>
                  <h3 class="text-xl font-bold text-center mb-4">I'm an Influencer/Coach</h3>
                  <p class="text-center text-muted-foreground mb-6">Share your expertise, build your client base, and grow your online presence with our coaching platform.</p>
                  <button class="button-primary w-full" id="coachSelectBtn">Select</button>
                </div>
              </div>
            </div>
          </div>
        `;
        // Responsive grid for mobile
        if (window.innerWidth <= 768) {
          const grid = stepContainer.querySelector('div[style*="grid-template-columns"]');
          if (grid) grid.style.gridTemplateColumns = '1fr';
          if (grid) grid.style.gap = '1rem';
        }
        document.getElementById('userSelectBtn').onclick = () => {
          userType = 'user';
          currentStep = 'user-auth-choice';
          renderStep();
        };
        document.getElementById('coachSelectBtn').onclick = () => {
          userType = 'coach';
          currentStep = 'coach-follower-question';
          renderStep();
        };
      } else if (currentStep === 'user-auth-choice') {
        stepContainer.innerHTML = `
          <div class="w-full max-w-2xl mx-auto px-4 animate-slide-in">
            <button class="flex items-center text-brand-purple mb-8 hover:underline gap-2" id="backBtnUserAuth" style="background:none;border:none;cursor:pointer;font:inherit;">
              <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg>
              <span>Back</span>
            </button>
            <div class="main-card">
              <h2 class="text-2xl md:text-3xl font-bold text-center mb-8">Continue as User</h2>
              <div class="flex flex-col md:flex-row gap-4 justify-center">
                <button class="button-primary" id="userEmailSignupBtn">Sign up with Email</button>
                <button class="button-secondary" id="userEmailLoginBtn">Log in with Email</button>
                <button class="button-secondary" id="userDiscordBtn">Sign up with Discord</button>
              </div>
            </div>
          </div>
        `;
        document.getElementById('backBtnUserAuth').onclick = () => {
          currentStep = 'select-type';
          renderStep();
        };
        document.getElementById('userEmailSignupBtn').onclick = () => {
          currentStep = 'user-email-signup';
          renderStep();
        };
        document.getElementById('userEmailLoginBtn').onclick = () => {
          currentStep = 'user-email-login';
          renderStep();
        };
        document.getElementById('userDiscordBtn').onclick = () => {
          // Discord OAuth flow for user
          const isPWA = window.matchMedia('(display-mode: standalone)').matches ||
                        window.navigator.standalone ||
                        document.referrer.includes('android-app://');
          if (isPWA) {
            const clientId = '1362382273369997462';
            const redirectUri = 'https://www.nevengi.com/pwa-oauth-landing.html';
            const scope = 'identify email';
            const discordOAuthUrl = `https://discord.com/api/oauth2/authorize?client_id=${encodeURIComponent(clientId)}&redirect_uri=${encodeURIComponent(redirectUri)}&response_type=code&scope=${encodeURIComponent(scope)}`;
            if ('serviceWorker' in navigator) {
              navigator.serviceWorker.getRegistrations().then(registrations => {
                registrations.forEach(registration => registration.unregister());
                window.location.href = discordOAuthUrl;
              });
            } else {
              window.location.href = discordOAuthUrl;
            }
          } else {
            window.location.href = '/auth/discord/user';
          }
        };
      } else if (currentStep === 'user-email-signup') {
        stepContainer.innerHTML = `
          <div class="w-full max-w-2xl mx-auto px-4">
            <button class="flex items-center text-brand-purple mb-8 hover:underline gap-2" id="backBtn" style="background:none;border:none;cursor:pointer;font:inherit;">
              <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg>
              <span>Back</span>
            </button>
            <div class="main-card animate-slide-in">
              <h2 class="text-2xl md:text-3xl font-bold text-center mb-6">Sign Up with Email</h2>
              <form id="emailSignupForm" style="width:100%;max-width:400px;margin:0 auto 1.5rem auto;padding:1.2rem 1rem;background:#fff;border-radius:1rem;box-shadow:0 2px 12px rgba(0,0,0,0.07);display:flex;flex-direction:column;gap:0.7rem;">
                <input type="email" id="signupEmail" placeholder="Email" required style="padding:0.7rem 1rem;border-radius:0.7rem;border:1px solid #ccc;font-size:1rem;">
                <input type="password" id="signupPassword" placeholder="Password" required style="padding:0.7rem 1rem;border-radius:0.7rem;border:1px solid #ccc;font-size:1rem;">
                <div id="codeSection" style="display:none;flex-direction:column;gap:0.5rem;">
                  <input type="text" id="signupCode" placeholder="Verification Code" maxlength="6" style="padding:0.7rem 1rem;border-radius:0.7rem;border:1px solid #ccc;font-size:1rem;">
                  <button type="button" id="resendCodeBtn" class="button-secondary" style="width:100%;">Resend Code</button>
                </div>
                <button type="submit" class="button-primary" id="signupSubmitBtn">Sign Up</button>
                <button type="button" id="verifyCodeBtn" class="button-primary" style="display:none;">Verify Code</button>
                <div id="emailSignupMsg" style="margin-top:0.5rem;font-size:0.98rem;text-align:center;"></div>
              </form>
            </div>
          </div>
        `;
        document.getElementById('backBtn').onclick = () => {
          currentStep = 'select-type';
          renderStep();
        };
        addEmailSignupLogic();
      } else if (currentStep === 'user-email-login') {
        stepContainer.innerHTML = `
          <div class="w-full max-w-2xl mx-auto px-4">
            <button class="flex items-center text-brand-purple mb-8 hover:underline gap-2" id="backBtnUserLogin" style="background:none;border:none;cursor:pointer;font:inherit;">
              <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg>
              <span>Back</span>
            </button>
            <div class="main-card animate-slide-in">
              <h2 class="text-2xl md:text-3xl font-bold text-center mb-6">Log In with Email</h2>
              <form id="userEmailLoginForm" style="width:100%;max-width:400px;margin:0 auto 1.5rem auto;padding:1.2rem 1rem;background:#fff;border-radius:1rem;box-shadow:0 2px 12px rgba(0,0,0,0.07);display:flex;flex-direction:column;gap:0.7rem;">
                <input type="email" id="userLoginEmail" placeholder="Email" required style="padding:0.7rem 1rem;border-radius:0.7rem;border:1px solid #ccc;font-size:1rem;">
                <input type="password" id="userLoginPassword" placeholder="Password" required style="padding:0.7rem 1rem;border-radius:0.7rem;border:1px solid #ccc;font-size:1rem;">
                <button type="submit" class="button-primary" id="userLoginSubmitBtn">Log In</button>
                <div id="userEmailLoginMsg" style="margin-top:0.5rem;font-size:0.98rem;text-align:center;"></div>
              </form>
            </div>
          </div>
        `;
        document.getElementById('backBtnUserLogin').onclick = () => {
          currentStep = 'user-auth-choice';
          renderStep();
        };
        addUserEmailLoginLogic();
      } else if (currentStep === 'coach-follower-question') {
        stepContainer.innerHTML = `
          <div class="w-full max-w-2xl mx-auto px-4 animate-slide-in">
            <button class="flex items-center text-brand-purple mb-8 hover:underline gap-2" id="backBtnCoachFollowers" style="background:none;border:none;cursor:pointer;font:inherit;">
              <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg>
              <span>Back</span>
            </button>
            <div class="main-card">
              <h2 class="text-2xl md:text-3xl font-bold text-center mb-8">Do you have more than 5,000 followers on any social media platform?</h2>
              <div class="w-32 h-32 mx-auto mb-8 animate-float">
                <img src="images/followers.webp" alt="Followers Count" class="w-full h-full" />
              </div>
              <div class="flex flex-col md:flex-row gap-4 justify-center">
                <button class="button-primary" id="yesFollowers">Yes, I have 5,000+ followers</button>
                <button class="button-secondary" id="noFollowers">Not yet</button>
              </div>
            </div>
          </div>
        `;
        document.getElementById('backBtnCoachFollowers').onclick = () => {
          currentStep = 'select-type';
          renderStep();
        };
        document.getElementById('yesFollowers').onclick = () => {
          currentStep = 'coach-auth-choice';
          renderStep();
        };
        document.getElementById('noFollowers').onclick = () => {
          currentStep = 'coach-insufficient-followers';
          renderStep();
        };
      } else if (currentStep === 'coach-insufficient-followers') {
        stepContainer.innerHTML = `
          <div class="w-full max-w-2xl mx-auto px-4 animate-slide-in">
            <button class="flex items-center text-brand-purple mb-8 hover:underline gap-2" id="backBtnCoachInsufficient" style="background:none;border:none;cursor:pointer;font:inherit;">
              <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg>
              <span>Back</span>
            </button>
            <div class="main-card animate-slide-in">
              <h2 class="text-2xl md:text-3xl font-bold text-center mb-6">Keep Growing Your Audience!</h2>
              <div class="w-32 h-32 mx-auto mb-6 animate-pulse-soft">
                <img src="images/socialmediacontent.webp" alt="Growth Icon" class="w-full h-full" />
              </div>
              <p class="text-center text-muted-foreground mb-8">We love your enthusiasm! Our coach platform is currently designed for influencers with established audiences of 5,000+ followers.</p>
              <p class="text-center font-medium mb-8">In the meantime, we encourage you to join as a user and experience the platform from the client side while you grow your following.</p>
              <div class="flex flex-col md:flex-row gap-4 justify-center">
                <button class="button-primary" id="signupUserFromCoach">Sign Up as User</button>
                <button class="button-secondary" id="backBtnCoachInsufficient2">Go Back</button>
              </div>
            </div>
          </div>
        `;
        document.getElementById('backBtnCoachInsufficient').onclick = () => {
          currentStep = 'coach-follower-question';
          renderStep();
        };
        document.getElementById('backBtnCoachInsufficient2').onclick = () => {
          currentStep = 'coach-follower-question';
          renderStep();
        };
        document.getElementById('signupUserFromCoach').onclick = () => {
          userType = 'user';
          currentStep = 'user-auth-choice';
          renderStep();
        };
      } else if (currentStep === 'coach-auth-choice') {
        stepContainer.innerHTML = `
          <div class="w-full max-w-2xl mx-auto px-4 animate-slide-in">
            <button class="flex items-center text-brand-purple mb-8 hover:underline gap-2" id="backBtnCoachAuth" style="background:none;border:none;cursor:pointer;font:inherit;">
              <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg>
              <span>Back</span>
            </button>
            <div class="main-card">
              <h2 class="text-2xl md:text-3xl font-bold text-center mb-8">Continue as Coach</h2>
              <div class="flex flex-col md:flex-row gap-4 justify-center">
                <button class="button-primary" id="coachEmailSignupBtn">Sign up with Email</button>
                <button class="button-secondary" id="coachEmailLoginBtn">Log in with Email</button>
                <button class="button-secondary" id="coachDiscordBtn">Sign up with Discord</button>
              </div>
            </div>
          </div>
        `;
        document.getElementById('backBtnCoachAuth').onclick = () => {
          currentStep = 'select-type';
          renderStep();
        };
        document.getElementById('coachEmailSignupBtn').onclick = () => {
          currentStep = 'coach-email-signup';
          renderStep();
        };
        document.getElementById('coachEmailLoginBtn').onclick = () => {
          currentStep = 'coach-email-login';
          renderStep();
        };
        document.getElementById('coachDiscordBtn').onclick = () => {
          // Discord OAuth flow for coach
          const isPWA = window.matchMedia('(display-mode: standalone)').matches ||
                        window.navigator.standalone ||
                        document.referrer.includes('android-app://');
          if (isPWA) {
            const clientId = '1362382273369997462';
            const redirectUri = 'https://www.nevengi.com/pwa-oauth-landing-coach.html';
            const scope = 'identify email';
            const discordOAuthUrl = `https://discord.com/api/oauth2/authorize?client_id=${encodeURIComponent(clientId)}&redirect_uri=${encodeURIComponent(redirectUri)}&response_type=code&scope=${encodeURIComponent(scope)}`;
            if ('serviceWorker' in navigator) {
              navigator.serviceWorker.getRegistrations().then(registrations => {
                registrations.forEach(registration => registration.unregister());
                window.location.href = discordOAuthUrl;
              });
            } else {
              window.location.href = discordOAuthUrl;
            }
          } else {
            window.location.href = '/auth/discord';
          }
        };
      } else if (currentStep === 'coach-email-signup') {
        stepContainer.innerHTML = `
          <div class="w-full max-w-2xl mx-auto px-4">
            <button class="flex items-center text-brand-purple mb-8 hover:underline gap-2" id="backBtn" style="background:none;border:none;cursor:pointer;font:inherit;">
              <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg>
              <span>Back</span>
            </button>
            <div class="main-card animate-slide-in">
              <h2 class="text-2xl md:text-3xl font-bold text-center mb-6">Sign Up as Coach with Email</h2>
              <form id="coachEmailSignupForm" style="width:100%;max-width:400px;margin:0 auto 1.5rem auto;padding:1.2rem 1rem;background:#fff;border-radius:1rem;box-shadow:0 2px 12px rgba(0,0,0,0.07);display:flex;flex-direction:column;gap:0.7rem;">
                <input type="email" id="coachSignupEmail" placeholder="Email" required style="padding:0.7rem 1rem;border-radius:0.7rem;border:1px solid #ccc;font-size:1rem;">
                <input type="password" id="coachSignupPassword" placeholder="Password" required style="padding:0.7rem 1rem;border-radius:0.7rem;border:1px solid #ccc;font-size:1rem;">
                <div id="coachCodeSection" style="display:none;flex-direction:column;gap:0.5rem;">
                  <input type="text" id="coachSignupCode" placeholder="Verification Code" maxlength="6" style="padding:0.7rem 1rem;border-radius:0.7rem;border:1px solid #ccc;font-size:1rem;">
                  <button type="button" id="coachResendCodeBtn" class="button-secondary" style="width:100%;">Resend Code</button>
                </div>
                <button type="submit" class="button-primary" id="coachSignupSubmitBtn">Sign Up</button>
                <button type="button" id="coachVerifyCodeBtn" class="button-primary" style="display:none;">Verify Code</button>
                <div id="coachEmailSignupMsg" style="margin-top:0.5rem;font-size:0.98rem;text-align:center;"></div>
              </form>
            </div>
          </div>
        `;
        document.getElementById('backBtn').onclick = () => {
          currentStep = 'select-type';
          renderStep();
        };
        addCoachEmailSignupLogic();
      } else if (currentStep === 'coach-email-login') {
        stepContainer.innerHTML = `
          <div class="w-full max-w-2xl mx-auto px-4">
            <button class="flex items-center text-brand-purple mb-8 hover:underline gap-2" id="backBtnCoachLogin" style="background:none;border:none;cursor:pointer;font:inherit;">
              <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg>
              <span>Back</span>
            </button>
            <div class="main-card animate-slide-in">
              <h2 class="text-2xl md:text-3xl font-bold text-center mb-6">Log In as Coach with Email</h2>
              <form id="coachEmailLoginForm" style="width:100%;max-width:400px;margin:0 auto 1.5rem auto;padding:1.2rem 1rem;background:#fff;border-radius:1rem;box-shadow:0 2px 12px rgba(0,0,0,0.07);display:flex;flex-direction:column;gap:0.7rem;">
                <input type="email" id="coachLoginEmail" placeholder="Email" required style="padding:0.7rem 1rem;border-radius:0.7rem;border:1px solid #ccc;font-size:1rem;">
                <input type="password" id="coachLoginPassword" placeholder="Password" required style="padding:0.7rem 1rem;border-radius:0.7rem;border:1px solid #ccc;font-size:1rem;">
                <button type="submit" class="button-primary" id="coachLoginSubmitBtn">Log In</button>
                <div id="coachEmailLoginMsg" style="margin-top:0.5rem;font-size:0.98rem;text-align:center;"></div>
              </form>
            </div>
          </div>
        `;
        document.getElementById('backBtnCoachLogin').onclick = () => {
          currentStep = 'coach-auth-choice';
          renderStep();
        };
        addCoachEmailLoginLogic();
      }
    }
    renderStep();
    function addEmailSignupLogic() {
      const form = document.getElementById('emailSignupForm');
      const emailInput = document.getElementById('signupEmail');
      const passwordInput = document.getElementById('signupPassword');
      const codeSection = document.getElementById('codeSection');
      const codeInput = document.getElementById('signupCode');
      const signupBtn = document.getElementById('signupSubmitBtn');
      const verifyBtn = document.getElementById('verifyCodeBtn');
      const msg = document.getElementById('emailSignupMsg');
      const resendBtn = document.getElementById('resendCodeBtn');
      let email = '';
      form.onsubmit = async (e) => {
        e.preventDefault();
        signupBtn.disabled = true;
        msg.textContent = '';
        email = emailInput.value.trim();
        const password = passwordInput.value;
        if (!email || !password) { msg.textContent = 'Email and password required.'; signupBtn.disabled = false; return; }
        try {
          const res = await fetch('/auth/email-signup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
          });
          const data = await res.json();
          if (res.ok && data.success) {
            codeSection.style.display = 'flex';
            signupBtn.style.display = 'none';
            verifyBtn.style.display = 'inline-block';
            msg.textContent = 'Verification code sent to your email.';
          } else {
            msg.textContent = data.error || 'Signup failed.';
          }
        } catch (err) {
          msg.textContent = 'Network error.';
        }
        signupBtn.disabled = false;
      };
      verifyBtn.onclick = async () => {
        verifyBtn.disabled = true;
        msg.textContent = '';
        const code = codeInput.value.trim();
        if (!email || !code) { msg.textContent = 'Enter the code.'; verifyBtn.disabled = false; return; }
        try {
          const res = await fetch('/auth/email-verify', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, code })
          });
          const data = await res.json();
          if (res.ok && data.success && data.token) {
            msg.textContent = 'Signup complete! Redirecting...';
            localStorage.setItem('userToken', data.token);
            setTimeout(() => { window.location.href = '/user_dashboard.html'; }, 1200);
          } else {
            msg.textContent = data.error || 'Verification failed.';
          }
        } catch (err) {
          msg.textContent = 'Network error.';
        }
        verifyBtn.disabled = false;
      };
      resendBtn.onclick = async () => {
        resendBtn.disabled = true;
        msg.textContent = '';
        if (!email) { msg.textContent = 'Enter your email first.'; resendBtn.disabled = false; return; }
        try {
          const res = await fetch('/auth/email-resend', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email })
          });
          const data = await res.json();
          if (res.ok && data.success) {
            msg.textContent = 'Verification code resent.';
          } else {
            msg.textContent = data.error || 'Resend failed.';
          }
        } catch (err) {
          msg.textContent = 'Network error.';
        }
        resendBtn.disabled = false;
      };
    }
    function addCoachEmailSignupLogic() {
      const form = document.getElementById('coachEmailSignupForm');
      const emailInput = document.getElementById('coachSignupEmail');
      const passwordInput = document.getElementById('coachSignupPassword');
      const codeSection = document.getElementById('coachCodeSection');
      const codeInput = document.getElementById('coachSignupCode');
      const signupBtn = document.getElementById('coachSignupSubmitBtn');
      const verifyBtn = document.getElementById('coachVerifyCodeBtn');
      const msg = document.getElementById('coachEmailSignupMsg');
      const resendBtn = document.getElementById('coachResendCodeBtn');
      let email = '';
      form.onsubmit = async (e) => {
        e.preventDefault();
        signupBtn.disabled = true;
        msg.textContent = '';
        email = emailInput.value.trim();
        const password = passwordInput.value;
        if (!email || !password) { msg.textContent = 'Email and password required.'; signupBtn.disabled = false; return; }
        try {
          const res = await fetch('/auth/email-signup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password, role: 'coach' })
          });
          const data = await res.json();
          if (res.ok && data.success) {
            codeSection.style.display = 'flex';
            signupBtn.style.display = 'none';
            verifyBtn.style.display = 'inline-block';
            msg.textContent = 'Verification code sent to your email.';
          } else {
            msg.textContent = data.error || 'Signup failed.';
          }
        } catch (err) {
          msg.textContent = 'Network error.';
        }
        signupBtn.disabled = false;
      };
      verifyBtn.onclick = async () => {
        verifyBtn.disabled = true;
        msg.textContent = '';
        const code = codeInput.value.trim();
        if (!email || !code) { msg.textContent = 'Enter the code.'; verifyBtn.disabled = false; return; }
        try {
          const res = await fetch('/auth/email-verify', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, code, role: 'coach' })
          });
          const data = await res.json();
          if (res.ok && data.success && data.token) {
            msg.textContent = 'Signup complete! Redirecting...';
            localStorage.setItem('coachToken', data.token);
            setTimeout(() => { window.location.href = '/coach_dashboard.html'; }, 1200);
          } else {
            msg.textContent = data.error || 'Verification failed.';
          }
        } catch (err) {
          msg.textContent = 'Network error.';
        }
        verifyBtn.disabled = false;
      };
      resendBtn.onclick = async () => {
        resendBtn.disabled = true;
        msg.textContent = '';
        if (!email) { msg.textContent = 'Enter your email first.'; resendBtn.disabled = false; return; }
        try {
          const res = await fetch('/auth/email-resend', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, role: 'coach' })
          });
          const data = await res.json();
          if (res.ok && data.success) {
            msg.textContent = 'Verification code resent.';
          } else {
            msg.textContent = data.error || 'Resend failed.';
          }
        } catch (err) {
          msg.textContent = 'Network error.';
        }
        resendBtn.disabled = false;
      };
    }
    function addUserEmailLoginLogic() {
      const form = document.getElementById('userEmailLoginForm');
      const emailInput = document.getElementById('userLoginEmail');
      const passwordInput = document.getElementById('userLoginPassword');
      const loginBtn = document.getElementById('userLoginSubmitBtn');
      const msg = document.getElementById('userEmailLoginMsg');
      form.onsubmit = async (e) => {
        e.preventDefault();
        loginBtn.disabled = true;
        msg.textContent = '';
        const email = emailInput.value.trim();
        const password = passwordInput.value;
        if (!email || !password) { msg.textContent = 'Email and password required.'; loginBtn.disabled = false; return; }
        try {
          const res = await fetch('/auth/email-login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
          });
          const data = await res.json();
          if (res.ok && data.success && data.token) {
            msg.textContent = 'Login successful! Redirecting...';
            localStorage.setItem('userToken', data.token);
            setTimeout(() => { window.location.href = '/user_dashboard.html'; }, 1200);
          } else {
            msg.textContent = data.error || 'Login failed.';
          }
        } catch (err) {
          msg.textContent = 'Network error.';
        }
        loginBtn.disabled = false;
      };
    }
    function addCoachEmailLoginLogic() {
      const form = document.getElementById('coachEmailLoginForm');
      const emailInput = document.getElementById('coachLoginEmail');
      const passwordInput = document.getElementById('coachLoginPassword');
      const loginBtn = document.getElementById('coachLoginSubmitBtn');
      const msg = document.getElementById('coachEmailLoginMsg');
      form.onsubmit = async (e) => {
        e.preventDefault();
        loginBtn.disabled = true;
        msg.textContent = '';
        const email = emailInput.value.trim();
        const password = passwordInput.value;
        if (!email || !password) { msg.textContent = 'Email and password required.'; loginBtn.disabled = false; return; }
        try {
          const res = await fetch('/auth/email-login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password, role: 'coach' })
          });
          const data = await res.json();
          if (res.ok && data.success && data.token) {
            msg.textContent = 'Login successful! Redirecting...';
            localStorage.setItem('coachToken', data.token);
            setTimeout(() => { window.location.href = '/coach_dashboard.html'; }, 1200);
          } else {
            msg.textContent = data.error || 'Login failed.';
          }
        } catch (err) {
          msg.textContent = 'Network error.';
        }
        loginBtn.disabled = false;
      };
    }
    // Call this after rendering the step with Discord signup
    const observer = new MutationObserver(() => {
      if (document.getElementById('emailSignupForm')) {
        addEmailSignupLogic();
      }
    });
    observer.observe(document.getElementById('stepContainer'), { childList: true, subtree: true });
  </script>
</body>
</html> 